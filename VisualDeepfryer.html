<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Visual Deepfryer</title>
<style>
body {
    background:#0e0e0e;
    color:#fff;
    font-family:Arial, sans-serif;
    text-align:center;
    padding:0;
    margin:0;
}

/* Top bar */
.topbar {
    background:#1b1b1b;
    display:flex;
    justify-content:space-between;
    padding:10px 20px;
    position:sticky;
    top:0;
    z-index:1000;
}
.topbar a {
    color:#fff;
    text-decoration:none;
    font-weight:bold;
    padding:6px 12px;
    border-radius:6px;
    transition:0.2s;
}
.topbar a:hover { background:#333; }

/* Main box */
.box {
    background:#1b1b1b;
    padding:20px;
    border-radius:12px;
    display:inline-block;
    width:500px;
    margin-top:20px;
}
button {
    padding:12px;
    margin:6px;
    background:#ff5722;
    border:none;
    border-radius:6px;
    cursor:pointer;
    color:#fff;
    font-weight:bold;
}
button:hover { background:#ff7043; }
input[type=range], input[type=file] { width:100%; margin:6px 0; }
canvas, video { max-width:100%; border-radius:12px; margin-top:10px; }
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
    <a href="VisualDeepfryer.html">Visual Deepfryer</a>
    <a href="Index.html">MP3 Deepfryer</a>
</div>

<h1>ðŸŽ¨ Visual Deepfryer</h1>
<p>Images & MP4 videos (sound removed)</p>

<div class="box">
<h3>Upload Image or Video</h3>
<input type="file" id="fileInput" accept="image/*,video/mp4"><br>

<label>Intensity (0-100)</label>
<input type="range" id="intensity" min="0" max="100" value="50"><br>

<label>Red Boost (0-100)</label>
<input type="range" id="redBoost" min="0" max="100" value="0"><br>

<button onclick="processFile()">Deepfry!</button>

<canvas id="canvas"></canvas>
<video id="video" controls muted style="display:none;"></video><br>
<a id="download">Download</a>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const videoEl = document.getElementById("video");

function deepfryImage(img, intensity=50, redBoost=0){
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img,0,0);

    let imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    let data = imageData.data;

    const contrast = 1 + intensity/50;
    const saturation = 1 + intensity/70;

    for(let i=0;i<data.length;i+=4){
        let r = data[i];
        let g = data[i+1];
        let b = data[i+2];

        // Increase contrast
        r = ((r/255-0.5)*contrast+0.5)*255;
        g = ((g/255-0.5)*contrast+0.5)*255;
        b = ((b/255-0.5)*contrast+0.5)*255;

        // Increase saturation
        let avg = (r+g+b)/3;
        r = avg + (r-avg)*saturation;
        g = avg + (g-avg)*saturation;
        b = avg + (b-avg)*saturation;

        // Random noise
        const noise = (Math.random()-0.5)*intensity*2;
        r = Math.min(255,Math.max(0,r+noise));
        g = Math.min(255,Math.max(0,g+noise));
        b = Math.min(255,Math.max(0,b+noise));

        // Apply red boost
        r = Math.min(255,r + (redBoost/100)*255);

        data[i] = r;
        data[i+1] = g;
        data[i+2] = b;
    }

    ctx.putImageData(imageData,0,0);
}

function downloadCanvas(filename="deepfried.png"){
    const url = canvas.toDataURL("image/png");
    const a = document.getElementById("download");
    a.href = url;
    a.download = filename;
    a.click();
}

function processFile(){
    const file = document.getElementById("fileInput").files[0];
    const intensity = parseInt(document.getElementById("intensity").value);
    const redBoost = parseInt(document.getElementById("redBoost").value);

    if(!file) return alert("Upload a file first");

    const url = URL.createObjectURL(file);

    if(file.type.startsWith("image")){
        videoEl.style.display = "none";
        canvas.style.display = "block";

        const img = new Image();
        img.onload = ()=> deepfryImage(img,intensity,redBoost);
        img.src = url;

        document.getElementById("download").onclick = ()=> downloadCanvas(file.name.split('.')[0]+" - Deepfried.png");

    } else if(file.type === "video/mp4"){
        canvas.style.display = "none";
        videoEl.style.display = "block";
        videoEl.src = url;
        videoEl.muted = true; // always muted
        videoEl.play();

        const offCanvas = document.createElement("canvas");
        const offCtx = offCanvas.getContext("2d");
        offCanvas.width = videoEl.videoWidth || 640;
        offCanvas.height = videoEl.videoHeight || 360;

        const stream = offCanvas.captureStream();
        const recorder = new MediaRecorder(stream, { mimeType: "video/webm" });
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = ()=> {
            const blob = new Blob(chunks,{type:"video/webm"});
            const a = document.getElementById("download");
            a.href = URL.createObjectURL(blob);
            a.download = file.name.split('.')[0]+" - Deepfried.webm";
            a.click();
        };
        recorder.start();

        videoEl.onplay = ()=>{
            function drawFrame(){
                if(videoEl.paused || videoEl.ended){
                    recorder.stop();
                    return;
                }
                offCtx.drawImage(videoEl,0,0,offCanvas.width,offCanvas.height);
                // Deepfry frame
                let frame = offCtx.getImageData(0,0,offCanvas.width,offCanvas.height);
                let data = frame.data;

                const contrast = 1 + intensity/50;
                const saturation = 1 + intensity/70;

                for(let i=0;i<data.length;i+=4){
                    let r = data[i], g = data[i+1], b = data[i+2];
                    let avg = (r+g+b)/3;
                    r = ((r/255-0.5)*contrast+0.5)*255; 
                    g = ((g/255-0.5)*contrast+0.5)*255;
                    b = ((b/255-0.5)*contrast+0.5)*255;

                    // Saturation
                    r = avg + (r-avg)*saturation;
                    g = avg + (g-avg)*saturation;
                    b = avg + (b-avg)*saturation;

                    // Noise
                    const noise = (Math.random()-0.5)*intensity*2;
                    r = Math.min(255,Math.max(0,r+noise));
                    g = Math.min(255,Math.max(0,g+noise));
                    b = Math.min(255,Math.max(0,b+noise));

                    // Red boost
                    r = Math.min(255,r + (redBoost/100)*255);

                    data[i] = r;
                    data[i+1] = g;
                    data[i+2] = b;
                }
                offCtx.putImageData(frame,0,0);
                requestAnimationFrame(drawFrame);
            }
            drawFrame();
        };
    } else {
        alert("Unsupported file type");
    }
}
</script>

</body>
</html>
