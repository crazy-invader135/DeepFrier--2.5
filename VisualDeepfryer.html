<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Visual Deepfryer (Full Video)</title>
<style>
body {
    background:#0e0e0e;
    color:#fff;
    font-family:Arial, sans-serif;
    text-align:center;
    padding:0;
    margin:0;
}
.topbar {
    background:#1b1b1b;
    display:flex;
    justify-content:space-between;
    padding:10px 20px;
    position:sticky;
    top:0;
    z-index:1000;
}
.topbar a {
    color:#fff;
    text-decoration:none;
    font-weight:bold;
    padding:6px 12px;
    border-radius:6px;
    transition:0.2s;
}
.topbar a:hover { background:#333; }

.box {
    background:#1b1b1b;
    padding:20px;
    border-radius:12px;
    display:inline-block;
    width:500px;
    margin-top:20px;
}
button {
    padding:12px;
    margin:6px;
    background:#ff5722;
    border:none;
    border-radius:6px;
    cursor:pointer;
    color:#fff;
    font-weight:bold;
}
button:hover { background:#ff7043; }
input[type=range], input[type=file] { width:100%; margin:6px 0; }
#progress-container { width:100%; background:#333; border-radius:6px; margin-top:10px; }
#progress-bar { height:20px; width:0%; background:#4caf50; border-radius:6px; }
#progress-text { margin-top:6px; font-size:14px; }
</style>
</head>
<body>

<div class="topbar">
    <a href="VisualDeepfryer.html">Visual Deepfryer</a>
    <a href="Index.html">MP3 Deepfryer</a>
</div>

<h1>ðŸŽ¨ Visual Deepfryer (Full Video)</h1>
<p>Upload MP4 videos â€” audio muted, red boost & intensity applied</p>

<div class="box">
<input type="file" id="fileInput" accept="video/mp4"><br>

<label>Intensity (0-100)</label>
<input type="range" id="intensity" min="0" max="100" value="50"><br>

<label>Red Boost (0-100)</label>
<input type="range" id="redBoost" min="0" max="100" value="0"><br>

<button onclick="processVideo()">Deepfry & Download</button>

<div id="progress-container">
    <div id="progress-bar"></div>
</div>
<div id="progress-text"></div>

<a id="download">Download</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.8/dist/ffmpeg.min.js"></script>
<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });
const progressBar = document.getElementById("progress-bar");
const progressText = document.getElementById("progress-text");

async function processVideo(){
    const file = document.getElementById("fileInput").files[0];
    if(!file) return alert("Upload a video first");

    const intensity = parseInt(document.getElementById("intensity").value);
    const redBoost = parseInt(document.getElementById("redBoost").value);

    progressText.textContent = "Loading FFmpeg...";
    if(!ffmpeg.isLoaded()) await ffmpeg.load();

    const inputName = "input.mp4";
    const outputName = file.name.split('.')[0]+" - Deepfried.mp4";

    ffmpeg.FS('writeFile', inputName, await fetchFile(file));

    // Build filter for deepfrying
    // 1. eq=contrast & saturation (intensity)
    // 2. colorchannelmixer= increase red
    const contrast = 1 + intensity/100;
    const saturation = 1 + intensity/100;
    const redFactor = 1 + redBoost/100;

    const filter = `eq=contrast=${contrast}:saturation=${saturation},colorchannelmixer=rr=${redFactor}:gg=1:bb=1`;

    progressText.textContent = "Processing video... (this may take a while)";
    ffmpeg.setProgress(({ ratio })=>{
        progressBar.style.width = `${Math.floor(ratio*100)}%`;
        progressText.textContent = `Processing video... ${Math.floor(ratio*100)}%`;
    });

    await ffmpeg.run("-i", inputName, "-vf", filter, "-an", "-c:v", "libx264", "-preset", "fast", outputName);

    const data = ffmpeg.FS('readFile', outputName);
    const url = URL.createObjectURL(new Blob([data.buffer], { type: "video/mp4" }));
    const a = document.getElementById("download");
    a.href = url;
    a.download = outputName;
    a.click();

    progressText.textContent = "Done!";
    progressBar.style.width = "100%";
}
</script>
</body>
</html>
