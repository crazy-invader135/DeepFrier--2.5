<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Visual Deepfryer</title>

<style>
body {
    margin: 0;
    background: #0e0e0e;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
}

.topbar {
    background: #1b1b1b;
    display: flex;
    justify-content: space-between;
    padding: 10px 20px;
    position: sticky;
    top: 0;
}

.topbar a {
    color: #fff;
    text-decoration: none;
    font-weight: bold;
    padding: 6px 12px;
    border-radius: 6px;
}

.topbar a:hover {
    background: #333;
}

.box {
    background: #1b1b1b;
    padding: 20px;
    border-radius: 12px;
    width: 500px;
    margin: 30px auto;
}

button {
    padding: 12px;
    margin-top: 10px;
    width: 100%;
    background: #ff5722;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #ff7043;
}

input[type=file], input[type=range] {
    width: 100%;
    margin: 6px 0;
}

#progress-container {
    background: #333;
    border-radius: 6px;
    margin-top: 10px;
    height: 20px;
}

#progress-bar {
    background: #4caf50;
    height: 100%;
    width: 0%;
    border-radius: 6px;
}

#progress-text {
    margin-top: 6px;
    font-size: 14px;
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
    <a href="VisualDeepfryer.html">Visual Deepfryer</a>
    <a href="Index.html">MP3 Deepfryer</a>
</div>

<h1>ðŸŽ¨ Visual Deepfryer</h1>
<p>Full MP4 deepfrying â€¢ No audio â€¢ Browser-based</p>

<div class="box">
    <input type="file" id="fileInput" accept="video/mp4">

    <label>Intensity (0â€“100)</label>
    <input type="range" id="intensity" min="0" max="100" value="50">

    <label>Red Boost (0â€“100)</label>
    <input type="range" id="redBoost" min="0" max="100" value="0">

    <button onclick="processVideo()">Deepfry & Download</button>

    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
    <div id="progress-text"></div>
</div>

<a id="download"></a>

<!-- FFmpeg WASM -->
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>

<script>
const { FFmpeg } = FFmpegWASM;
const ffmpeg = new FFmpeg();

const progressBar = document.getElementById("progress-bar");
const progressText = document.getElementById("progress-text");

async function loadFFmpeg() {
    if (ffmpeg.loaded) return;

    progressText.textContent = "Loading FFmpeg (first time only)...";

    await ffmpeg.load({
        coreURL: "https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js",
        wasmURL: "https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.wasm"
    });
}

async function processVideo() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("Please upload an MP4");

    await loadFFmpeg();

    progressText.textContent = "Preparing video...";
    progressBar.style.width = "5%";

    await ffmpeg.writeFile("input.mp4", await file.arrayBuffer());

    const intensity = parseInt(document.getElementById("intensity").value);
    const redBoost = parseInt(document.getElementById("redBoost").value);

    const contrast = 1 + intensity / 100;
    const saturation = 1 + intensity / 100;
    const red = 1 + redBoost / 100;

    const filter =
        `eq=contrast=${contrast}:saturation=${saturation},` +
        `colorchannelmixer=rr=${red}:gg=1:bb=1`;

    progressText.textContent = "Processing videoâ€¦ (do not close tab)";
    progressBar.style.width = "25%";

    await ffmpeg.exec([
        "-i", "input.mp4",
        "-vf", filter,
        "-an",
        "-movflags", "faststart",
        "output.mp4"
    ]);

    progressBar.style.width = "90%";
    progressText.textContent = "Finalizing download...";

    const data = await ffmpeg.readFile("output.mp4");
    const blob = new Blob([data.buffer], { type: "video/mp4" });

    const url = URL.createObjectURL(blob);
    const a = document.getElementById("download");
    a.href = url;
    a.download = file.name.replace(".mp4", " - Deepfried.mp4");
    a.click();

    progressBar.style.width = "100%";
    progressText.textContent = "Done!";
}
</script>

</body>
</html>
